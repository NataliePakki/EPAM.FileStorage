@model MvcPL.Models.TableViewModel
@{
    ViewBag.Title = "User Files";
    AjaxOptions ajaxOptions = new AjaxOptions {
        UpdateTargetId = "userTable"
    };
}
@section Header{
    <h2>
        @Html.ActionLink("Home", "AllPublicFiles", "File", null, htmlAttributes: new {@style = "color: #666;"})
        / User Files
    </h2>
}
@section Body{
    <hr />
    <div class="form-group text-center">
        <div class="col-md-12 form-block">
            <div class="col-md-7">
                @using (Html.BeginForm("UserFiles", "File", FormMethod.Get)) {
                    <div class="search_form">
                        <input type="text" id="searchUserFiles" name="search" class="form-control input-sm" maxlength="64" placeholder="Search" value=@Model.SearchSubString>
                        <button type="submit" id="btnSearch" class="btn btn-primary btn-sm">Search</button>
                    </div>
                }
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    @Html.ActionLink("+", "Create", "File", new {userId = @Model.UserId}, new { @class = "btn btn-primary btn-sm", id = "lnkCreate"})
                </div>
            </div>
        </div>
    </div>


    <div id="userTable">
        @Html.Partial("_UserFileTable", Model)
        @*@Html.Action("GetFilesPage", "File", new {page = Model})*@
    </div>

}
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function() {
            $("#lnkCreate").on("click", function(e) {
                e.preventDefault();
                $("<div id='dialogContent'></div>")
                    .addClass("dialog")
                    .appendTo("body")
                    .dialog({
                        title: "Create",
                        width: 500,
                        height: 400,
                        close: function() { $(this).remove() },
                        modal: true,
                        buttons: [
                            {
                                text: "Create",
                                click: function () {
                                    var formData = new FormData($("#form-create").get(0));
                                    $.ajax({
                                        type: "POST",
                                        url: "/File/Create",
                                        data: formData,
                                        cache: false,
                                        processData: false,
                                        contentType: false,
                                        success: function (response) {
                                            $("#userTable").html(response);
                                        }
                                    });
                                    $(this).dialog("close");
                                }
                            }
                        ]
                    })
                    .load(this.href);
            });
            $(".close").on("click", function(e) {
                e.preventDefault();
                $(this).closest(".dialog").dialog("close");
            });
        });
    </script>

}
